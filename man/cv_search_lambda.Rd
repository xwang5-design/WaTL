% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cross_validation.R
\name{cv_search_lambda}
\alias{cv_search_lambda}
\title{Cross-Validation for Lambda Selection}
\usage{
cv_search_lambda(
  Y_t,
  s_vec,
  X_t,
  source_d,
  M,
  lambda_grid = NULL,
  n_folds = 5,
  max_iter = 200,
  step_size = 0.5,
  tol = 1e-06,
  n_cores = NULL,
  val_sample_size = 30
)
}
\arguments{
\item{Y_t}{Target quantile functions (n_0 x M matrix).}

\item{s_vec}{Global Frechet weights for target (length n_0).}

\item{X_t}{Target predictors.}

\item{source_d}{List of source datasets.}

\item{M}{Grid size for quantile functions.}

\item{lambda_grid}{Vector of candidate lambda values to test.}

\item{n_folds}{Number of folds for cross-validation (default 5).}

\item{max_iter}{Maximum iterations for gradient descent (default 200).}

\item{step_size}{Step size for gradient descent (default 0.5).}

\item{tol}{Convergence tolerance (default 1e-6).}

\item{n_cores}{Number of cores for parallel processing (default NULL, uses detectCores() - 1).}

\item{val_sample_size}{Validation sample size per fold (default 30).}
}
\value{
A list with components:
  \item{results}{Data frame with lambda values and corresponding CV errors}
  \item{best_lambda}{The lambda value with minimum CV error}
  \item{total_time}{Total time elapsed for cross-validation}
}
\description{
Performs k-fold cross-validation to select the optimal regularization parameter
lambda for the WaTL algorithm.
}
\examples{
\dontrun{
data <- simulate_data_setting1(n_t = 200, n_vec = c(100, 200), M = 100, K = 2)
X_t_mat <- to_matrix(data$X_t)
xbar <- colMeans(X_t_mat)
Sigma <- cov(X_t_mat) * (nrow(X_t_mat)-1)/nrow(X_t_mat)
invSigma <- solve(Sigma)
s_vec <- sapply(1:nrow(X_t_mat), function(i){
  as.numeric(1 + (X_t_mat[i,] - xbar) \%*\% invSigma \%*\% (0.5 - xbar))
})
cv_out <- cv_search_lambda(Y_t = data$Y_t, s_vec = s_vec, X_t = data$X_t,
                           source_d = data$source_data, M = 100,
                           lambda_grid = seq(0, 1, by = 0.1))
}
}
