% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/watl_algorithm.R
\name{compute_f_L2}
\alias{compute_f_L2}
\title{Compute Bias-Corrected Estimator (Step 2 of WaTL)}
\usage{
compute_f_L2(
  Y_t,
  s_vec,
  f1_hat,
  lambda,
  M,
  max_iter = 1000,
  step_size = 0.5,
  tol = 1e-08
)
}
\arguments{
\item{Y_t}{Target quantile functions (n_0 x M matrix).}

\item{s_vec}{Global Frechet weights for target (length n_0).}

\item{f1_hat}{Weighted auxiliary estimator from Step 1 (length M).}

\item{lambda}{Regularization parameter.}

\item{M}{Grid size.}

\item{max_iter}{Maximum iterations for gradient descent (default 1000).}

\item{step_size}{Step size for gradient descent (default 0.5).}

\item{tol}{Convergence tolerance (default 1e-8).}
}
\value{
The bias-corrected estimator (vector of length M).
}
\description{
Implements the bias-corrected estimator using gradient descent to minimize
a regularized objective function.
}
\details{
The bias-corrected estimator solves:
\deqn{\hat{f}_0(x) = \arg\min_{g \in L^2(0,1)} \frac{1}{n_0} \sum_{i=1}^{n_0} s_i ||F^{-1}_{\nu_i^{(0)}} - g||_2^2 + \lambda ||g - \hat{f}(x)||_2}

where:
\itemize{
  \item First term: Target data fidelity (uses global Frechet weights s_i)
  \item Second term: Regularization toward auxiliary estimator from Step 1
  \item lambda: Regularization parameter (selected via cross-validation)
}
}
\examples{
\dontrun{
data <- simulate_data_setting1(n_t = 200, n_vec = c(100, 200), M = 100, K = 2)
f1_hat <- compute_f1_hat(data$source_data, X_value = 0.5, M = 100,
                         X_t = data$X_t, Y_t = data$Y_t)
X_t_mat <- to_matrix(data$X_t)
xbar <- colMeans(X_t_mat)
Sigma <- cov(X_t_mat) * (nrow(X_t_mat)-1)/nrow(X_t_mat)
invSigma <- solve(Sigma)
s_vec <- sapply(1:nrow(X_t_mat), function(i){
  as.numeric(1 + (X_t_mat[i,] - xbar) \%*\% invSigma \%*\% (0.5 - xbar))
})
f_hat <- compute_f_L2(data$Y_t, s_vec, f1_hat, lambda = 0.1, M = 100)
}
}
